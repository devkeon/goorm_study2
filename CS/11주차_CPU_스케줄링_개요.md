# 11-1 CPU 스케줄링 개요

## CPU 스케줄링이란?

CPU 스케줄링은 한정된 CPU 자원을 적절한 기준에 따라 처리될 순서와 타이밍을 지정해 주는 것입니다. 스케줄링의 근본적인 목표는 프로세스의 가동률을 높게 유지하는 것이다.

> CPU 스케줄링은 컴퓨터 성능과도 직결되는 대단히 중요한 문제라고 합니다. 

> 현명하지 못하게 CPU를 배분하면 프로세스들이 실행되지 못하거나, 무질서한 상태가 발생할 수 있다고 합니다.


스케줄링에서 I/O-bound, 연산 위주의 CPU-bound 2가지로 분류해서 생각할 수 있다. I/O-bound들은 실행 시간이 짧으나 사용자의 만족도를 위해 빠르게 처리될수록 좋습니다. 테스크들이 대기하고 모여있는 것을 대기 큐(스케줄링 큐)라고 하고, 대기 큐는 항상 FIFO 형식이 아닐 수도 있습니다. 운영체제는 테스크의 중요도를 매겨서 다른 대기하고 있는 테스크보다 먼저 프로세스를 할당 시킬 수 있습니다.

> 중요도를 매겨서 우선순위를 정한다고 우선순위 큐같은 자료구조를 사용할 경우 영원히 프로세스가 실행되지 않을 수 도 있습니다.

## 선점 및 비선점 스케줄링

스케줄링 결정은 다음과 같이 4가지 상황에서 발생한다. 스케줄링 결정은 프로세서에서 실행되는 태스크를 교체하는 것 뿐 아니라, 대기하고 있는 태스크들의 상태에 변화를 주는 것도 포함한다.

<img src="https://mblogthumb-phinf.pstatic.net/MjAyMzAzMzBfMTY2/MDAxNjgwMTU5MTY4NzQz.2pVvhPNNw-1EChG_3uQ-MkFXO4GCZ9e0Nez2bJvAhCkg.6D-6csQAD49JMtjiDmDJ14txc8nagUDR7bPQcbURXyQg.PNG.kks227/3-2.png?type=w800">
<br>
**11.1.** 프로세스의 상태와 그 이동을 나타낸 FSM

1. 프로세스가 실행 상태에서 대기 상태로 전환될 때 (I/O 요청 혹은 wait() 호출 등)
2. 프로세스가 실행 상태에서 준비 완료 상태로 전환될 때 (인터럽트 발생 등)
3. 프로세스가 대기 상태에서 준비 완료 상태로 전환될 때 (I/O의 종료 등)
4. 프로세스가 종료할 때

⠀이때 1번과 4번의 경우는 현재 프로세스가 더 이상 실행될 수 없으므로 선택의 여지가 없이 자연스럽게 활성 프로세스가 교체될 것이다. 2번과 3번의 경우 프로세스를 교체할 수도, 안 교체할 수도 있다. 1번과 4번의 경우에만 프로세스가 교체되는 스케줄링 방식을 **비선점(non-preemptive)**형, 2번과 3번에도 프로세스가 교체될 수 있는 스케줄링 방식을 **선점(preemptive)**형이라 부른다. 선점이라는 표현은 끼어드는 프로세스의 입장에서 바라본 것이다.
선점 방식의 스케줄링은 보다 유연한 스케줄러 설계가 가능하게 하지만, 동시에 비선점 방식에서 신경쓸 필요가 없었던 동기화 문제를 발생시킨다. 또한, 선점 방식은 특정 태스크들이 불합리할 정도로 경쟁에서 뒤쳐져 실행이 거의 되지 못하는 **기아(starvation)** 상태로 만들 수도 있다.


> 우린 그럼 기아 상태로 빠지지 않으면서 CPU를 스케줄링할 알고리즘이 필요하겠군요!!!

## 스케줄링 알고리즘


#### 선입 선처리(FCFS)

먼저 대기한 프로세스를 먼저 할당하여 처리하는 방식으로 비선점형입니다. 비효율적인 처리가 일어날 때가 많다고 합니다.


#### 최단 작업 우선(SJF)

FCFS 방식에서 실행시간이 짧은 프로세스를 먼저 할당하여 평균 대기 시간이 줄어들었습니다. 실행 시간이 긴 프로세스가 있을 경우 기아 상태를 만들어낼 확률이 높아집니다.

CPU 버스트시간이 짧은 프로세스를 먼저 할당하는 방식으로 대기 시간이 줄어들고 빠르게 CPU 버스트 시간이 짧은 프로세스들이 처리되지만, 실행시간이 긴 프로세스보다 예상 실행시간이 짧은 프로세스가 들어오면 우선순위가 뺏겨 실행 시간이 긴 프로세스는 대기 큐에서 오래 남아 기아 상태에 빠지게 되는거죠.

이 문제를 해결하기 위해 현재 잔여 시간으로 우선순위를 결정하는 최소 잔여 시간 우선(SRTF)가 존재하지만 SRTF 역시 실행시간이 긴 프로세스는 기아 상태에 빠지곤 합니다.

> CPU를 이용하는 작업을 CPU 버스트라고 하고, 입출력 장치를 기다리는 시간을 IO 버스트라고 부른다고 합니다.


#### 라운드 로빈(RR) 스케줄링

FCFS 방식과 유사하지만 시간 할당량을 부여 받아서 처리합니다. RR 방식은 평균 대기 시간이 대부분 많지만, 불균형한 할당을 보다 잘 피할 수 있어 총 처리 시간의 최댓값이 감소합니다.

시간 할당량의 단위가 작을 수록 균형있는 할당이 가능하지만, 문맥 교환 시간이 매우 커지게 됩니다. 시간 할당량을 잘 분배해서 적절한 중간선을 찾아야 합니다.

#### 




